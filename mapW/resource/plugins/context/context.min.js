/* 
 * Context.js
 * Copyright Jacob Kelley
 * MIT License
 */'use strict';var context=context||function(){function l(a,f,e){h=[];e=$('\x3cul class\x3d"dropdown-menu dropdown-context'+(e?" dropdown-context-sub":"")+(c.compress?" compressed-context":"")+'" id\x3d"dropdown-'+f+'"\x3e\x3c/ul\x3e');var b=0,g=0,m="";for(b;b<a.length;b++){if("undefined"!==typeof a[b].divider)e.append('\x3cli class\x3d"divider"\x3e\x3c/li\x3e');else if("undefined"!==typeof a[b].header)e.append('\x3cli class\x3d"nav-header"\x3e'+a[b].header+"\x3c/li\x3e");else{"undefined"==typeof a[b].href&&(a[b].href="#");"undefined"!==typeof a[b].target&&(m=' target\x3d"'+a[b].target+'"');$sub="undefined"!==typeof a[b].subMenu?'\x3cli class\x3d"dropdown-submenu"\x3e\x3ca tabindex\x3d"-1" href\x3d"'+a[b].href+'"\x3e'+a[b].text+"\x3c/a\x3e\x3c/li\x3e":$('\x3cli\x3e\x3ca tabindex\x3d"-1" href\x3d"'+a[b].href+'"'+m+"\x3e"+a[b].text+"\x3c/a\x3e\x3c/li\x3e");if("undefined"!==typeof a[b].action){var d="event-"+(new Date).getTime()*Math.floor(1E5*Math.random());h.push(a[b].action);$sub.find("a").attr({id:d,"data-id":g});g++;$("#"+d).addClass("context-event");$(document).on("click","#"+d,function(b){b=parseInt($(this).data("id"));h[b].call(this,n)})}e.append($sub);"undefined"!=typeof a[b].subMenu&&(d=l(a[b].subMenu,f,!0),e.find("li:last").append(d))}"function"==typeof c.filter&&c.filter(e.find("li:last"))}return e}var k,p,h=[],n,c={fadeSpeed:100,filter:function(a){},above:"auto",preventDoubleContext:!0,compress:!1};return{init:function(a){c=$.extend({},c,a);k=a.map;p=a.basicTools;$(document).on("click","#map",function(){$(".dropdown-context").fadeOut(c.fadeSpeed,function(){$(".dropdown-context").css({display:""}).find(".drop-left").removeClass("drop-left")})});$(document).on("mouseleave",".dropdown-context",function(){$(".dropdown-context").fadeOut(c.fadeSpeed,function(){$(".dropdown-context").css({display:""}).find(".drop-left").removeClass("drop-left")})});if(c.preventDoubleContext)$(document).on("contextmenu",".dropdown-context",function(a){a.preventDefault()});$(document).on("mouseenter",".dropdown-submenu",function(){var a=$(this).find(".dropdown-context-sub:first"),c=a.width(),b=a.offset().left;c+b>window.innerWidth&&a.addClass("drop-left")})},settings:function(a){c=$.extend({},c,a)},attach:function(a,f){var e=(new Date).getTime();f=l(f,e);$("body").append(f);var b=null;$(a).hasClass("mapBar")?$("#slider_mapBar").bind("input propertychange",function(){null!=b&&b.setOpacity(parseFloat($(this).val()))}):$("#slider_layerView").bind("input propertychange",function(){null!=b&&b.setOpacity(parseFloat($(this).val()))});var g=null,b=null;$(document).on("contextmenu",a,function(a){a.preventDefault();a.stopPropagation();n=$(a.currentTarget);g=$(a.currentTarget).children("p").data("id")?$(a.currentTarget).children("p").data("id"):$(a.currentTarget).attr("id");b=k.getLayer(g);if("undefined"===typeof b||!1===b.visible)return b=null,!1;var d=p.changeOpacity(k,g);$(a.currentTarget).hasClass("node-layerTree")?$("#slider_layerView").val(d):$(a.currentTarget).hasClass("baseMap")&&$("#slider_mapBar").val(d);$(".dropdown-context:not(.dropdown-context-sub)").hide();d=$("#dropdown-"+e);if("boolean"==typeof c.above&&c.above)d.addClass("dropdown-context-up").css({top:a.pageY-20-$("#dropdown-"+e).height(),left:a.pageX-13}).fadeIn(c.fadeSpeed);else if("string"==typeof c.above&&"auto"==c.above){d.removeClass("dropdown-context-up");var f=d.height()+12;a.pageY+f>$(".map").height()?d.addClass("dropdown-context-up").css({top:a.pageY-20-f,left:a.pageX-13}).fadeIn(c.fadeSpeed):d.css({top:a.pageY+10,left:a.pageX-13}).fadeIn(c.fadeSpeed)}})},destroy:function(a){$(document).off("contextmenu",a).off("click",".context-event")}}}();